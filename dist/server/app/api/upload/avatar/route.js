"use strict";(()=>{var e={};e.id=9354,e.ids=[9354],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},73292:e=>{e.exports=require("fs/promises")},71017:e=>{e.exports=require("path")},53042:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>x,originalPathname:()=>b,patchFetch:()=>$,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>j});var a={};t.r(a),t.d(a,{POST:()=>v});var o=t(95419),n=t(69108),i=t(99678),s=t(78070),l=t(73292),u=t(57147),d=t(71017),c=t.n(d),p=t(58719);let f=c().join(process.cwd(),"public/uploads/avatars");async function g(){try{return(0,u.existsSync)(f)||(await (0,l.mkdir)(f,{recursive:!0}),console.log(`Created directory: ${f}`)),!0}catch(e){return console.error("Error creating upload directory:",e),!1}}async function v(e){try{if(!await g())return s.Z.json({error:"Could not create upload directory"},{status:500});let r=await e.formData(),t=r.get("file"),a=r.get("oldFileName");if(!t)return s.Z.json({error:"No file uploaded"},{status:400});let o=t.type;if(!o.startsWith("image/"))return s.Z.json({error:"File must be an image"},{status:400});let n=o.split("/")[1],i=`avatar-${(0,p.Z)()}.${n}`,d=c().join(f,i),v=await t.arrayBuffer();if(await (0,l.writeFile)(d,Buffer.from(v)),a)try{let e=c().join(f,a);console.log(`Attempting to delete old avatar at path: ${e}`),(0,u.existsSync)(e)?(await (0,l.unlink)(e),console.log(`Deleted old avatar: ${a}`)):console.log(`Old avatar file not found: ${a}`)}catch(e){console.error(`Error deleting old avatar: ${a}`,e)}let m=`/uploads/avatars/${i}`;return console.log("Avatar uploaded successfully:",{fileName:i,fileUrl:m,filePath:d,absolutePath:c().resolve(d)}),s.Z.json({success:!0,fileName:i,url:m})}catch(e){return console.error("Error uploading avatar:",e),s.Z.json({error:"Failed to upload avatar"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/upload/avatar/route",pathname:"/api/upload/avatar",filename:"route",bundlePath:"app/api/upload/avatar/route"},resolvedPagePath:"C:\\xampp\\htdocs\\car-booking-system-110\\car-booking-system-110\\app\\api\\upload\\avatar\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:w,headerHooks:x,staticGenerationBailout:j}=m,b="/api/upload/avatar/route";function $(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},58719:(e,r,t)=>{t.d(r,{Z:()=>d});var a=t(6113),o=t.n(a);let n=new Uint8Array(256),i=n.length,s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).substr(1));let u=function(e,r=0){let t=(l[e[r+0]]+l[e[r+1]]+l[e[r+2]]+l[e[r+3]]+"-"+l[e[r+4]]+l[e[r+5]]+"-"+l[e[r+6]]+l[e[r+7]]+"-"+l[e[r+8]]+l[e[r+9]]+"-"+l[e[r+10]]+l[e[r+11]]+l[e[r+12]]+l[e[r+13]]+l[e[r+14]]+l[e[r+15]]).toLowerCase();if(!("string"==typeof t&&s.test(t)))throw TypeError("Stringified UUID is invalid");return t},d=function(e,r,t){let a=(e=e||{}).random||(e.rng||function(){return i>n.length-16&&(o().randomFillSync(n),i=0),n.slice(i,i+=16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,r){t=t||0;for(let e=0;e<16;++e)r[t+e]=a[e];return r}return u(a)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1638,6206],()=>t(53042));module.exports=a})();