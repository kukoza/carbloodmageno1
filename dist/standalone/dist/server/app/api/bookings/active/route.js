(()=>{var e={};e.id=7268,e.ids=[7268],e.modules={13878:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=13878,e.exports=t},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},41808:e=>{"use strict";e.exports=require("net")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},58679:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>b});var a={};r.r(a),r.d(a,{GET:()=>u});var s=r(95419),o=r(69108),i=r(99678),n=r(47033),c=r(78070);async function u(){try{let e=await (0,n.JT)(`
      SELECT 
        b.id, b.userId, b.carId, b.startDate, b.endDate, b.startTime, b.endTime, 
        b.purpose, b.destination, b.status, b.startMileage, b.createdAt,
        u.name as userName, u.department, u.email, u.phone, u.avatar as profileImage,
        c.name as carName, c.licensePlate, c.currentMileage, c.type as carTypeName
      FROM Bookings b
      JOIN Users u ON b.userId = u.id
      JOIN Cars c ON b.carId = c.id
      WHERE b.status = 'อนุมัติแล้ว' AND b.endMileage IS NULL
      ORDER BY b.startDate ASC, b.startTime ASC
      `,[]);console.log("Active bookings found:",e.recordset.length);let t=e.recordset.map(e=>{let t=null!==e.startMileage&&void 0!==e.startMileage?Number.parseInt(e.startMileage,10):null!==e.currentMileage&&void 0!==e.currentMileage?Number.parseInt(e.currentMileage,10):0;return{id:e.id,userId:e.userId,carId:e.carId,startDate:e.startDate,endDate:e.endDate,startTime:e.startTime,endTime:e.endTime,purpose:e.purpose,destination:e.destination||null,status:e.status,startMileage:t,user:{name:e.userName,department:e.department,email:e.email,phone:e.phone,avatar:e.profileImage||"/placeholder.svg?height=40&width=40"},car:{name:e.carName,type:e.carTypeName,licensePlate:e.licensePlate,currentMileage:e.currentMileage?Number.parseInt(e.currentMileage,10):0}}});return c.Z.json(t)}catch(e){return console.error("Error fetching active bookings:",e),c.Z.json({error:"Failed to fetch active bookings"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/bookings/active/route",pathname:"/api/bookings/active",filename:"route",bundlePath:"app/api/bookings/active/route"},resolvedPagePath:"C:\\xampp\\htdocs\\car-booking-system-110\\car-booking-system-110\\app\\api\\bookings\\active\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:g,headerHooks:m,staticGenerationBailout:b}=l,h="/api/bookings/active/route";function v(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},47033:(e,t,r)=>{"use strict";r.d(t,{Fm:()=>u,JT:()=>n,jB:()=>c});var a=r(63069);let s={host:"43.229.132.209",user:process.env.DB_USER||"rootforbook",password:process.env.DB_PASSWORD||"534jj7?cA",database:process.env.DB_NAME||"carbookingsystem",waitForConnections:!0,connectionLimit:10,queueLimit:0},o=null;async function i(){if(!o)try{console.log("Creating database pool with config:",{host:s.host,user:s.user,database:s.database}),o=a.createPool(s),(await o.getConnection()).release(),console.log("Database pool created and tested successfully")}catch(e){throw console.error("Error creating database pool:",e),Error(`Database connection failed: ${e instanceof Error?e.message:String(e)}`)}return o}async function n(e,t=[]){try{let r=await i();console.log("Executing query:",e,"with params:",t);let[a]=await r.execute(e,t);return{recordset:a}}catch(e){throw console.error("Query execution error:",e),e}}async function c(e,t=[]){try{let{recordset:r}=await n(e,t);return r.length>0?r[0]:null}catch(e){throw console.error("Query execution error:",e),e}}async function u(e,t=[]){try{let r=await i();console.log("Executing insert:",e,"with params:",t);let[a]=await r.execute(e,t);return{insertId:a.insertId}}catch(e){throw console.error("Insert execution error:",e),e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,3069],()=>r(58679));module.exports=a})();