(()=>{var e={};e.id=1377,e.ids=[1377],e.modules={13878:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=13878,e.exports=t},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},41808:e=>{"use strict";e.exports=require("net")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},86205:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>x,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>y});var s={};r.r(s),r.d(s,{GET:()=>u,POST:()=>l});var a=r(95419),o=r(69108),i=r(99678),c=r(47033),n=r(78070);async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("status"),s=`
      SELECT c.id, c.name, c.type, c.licensePlate, c.status, 
             c.initialMileage, c.currentMileage, c.lastService, 
             c.nextService, c.image, c.fileName, c.createdAt,
             ct.name as typeName, ct.capacity
      FROM Cars c
      LEFT JOIN CarTypes ct ON c.typeId = ct.id
    `,a=[];r&&(s+=" WHERE c.status = ?",a.push(r)),s+=" ORDER BY c.name";let o=await (0,c.JT)(s,a);return n.Z.json(o.recordset)}catch(e){return console.error("Error fetching cars:",e),n.Z.json({error:"Failed to fetch cars"},{status:500})}}async function l(e){try{let{name:t,type:r,licensePlate:s,initialMileage:a,image:o,fileName:i,typeId:u}=await e.json();if(!t||!r||!s)return n.Z.json({error:"Missing required fields"},{status:400});if((await (0,c.JT)(`
      SELECT COUNT(*) as count FROM Cars WHERE licensePlate = ?
      `,[s])).recordset[0].count>0)return n.Z.json({error:"License plate already exists"},{status:409});let l=await (0,c.Fm)(`
      INSERT INTO Cars (name, type, licensePlate, initialMileage, currentMileage, status, image, fileName, typeId)
      VALUES (?, ?, ?, ?, ?, 'ว่าง', ?, ?, ?);
      `,[t,r,s,a||0,a||0,o||null,i||null,u||null]);return n.Z.json({id:l.insertId,name:t,type:r,licensePlate:s,initialMileage:a||0,currentMileage:a||0,status:"ว่าง",image:o,fileName:i,typeId:u},{status:201})}catch(e){return console.error("Error creating car:",e),n.Z.json({error:"Failed to create car"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/cars/route",pathname:"/api/cars",filename:"route",bundlePath:"app/api/cars/route"},resolvedPagePath:"C:\\xampp\\htdocs\\car-booking-system-110\\car-booking-system-110\\app\\api\\cars\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:h,headerHooks:m,staticGenerationBailout:y}=p,x="/api/cars/route";function f(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},47033:(e,t,r)=>{"use strict";r.d(t,{Fm:()=>u,JT:()=>c,jB:()=>n});var s=r(63069);let a={host:"43.229.132.209",user:process.env.DB_USER||"rootforbook",password:process.env.DB_PASSWORD||"534jj7?cA",database:process.env.DB_NAME||"carbookingsystem",waitForConnections:!0,connectionLimit:10,queueLimit:0},o=null;async function i(){if(!o)try{console.log("Creating database pool with config:",{host:a.host,user:a.user,database:a.database}),o=s.createPool(a),(await o.getConnection()).release(),console.log("Database pool created and tested successfully")}catch(e){throw console.error("Error creating database pool:",e),Error(`Database connection failed: ${e instanceof Error?e.message:String(e)}`)}return o}async function c(e,t=[]){try{let r=await i();console.log("Executing query:",e,"with params:",t);let[s]=await r.execute(e,t);return{recordset:s}}catch(e){throw console.error("Query execution error:",e),e}}async function n(e,t=[]){try{let{recordset:r}=await c(e,t);return r.length>0?r[0]:null}catch(e){throw console.error("Query execution error:",e),e}}async function u(e,t=[]){try{let r=await i();console.log("Executing insert:",e,"with params:",t);let[s]=await r.execute(e,t);return{insertId:s.insertId}}catch(e){throw console.error("Insert execution error:",e),e}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206,3069],()=>r(86205));module.exports=s})();