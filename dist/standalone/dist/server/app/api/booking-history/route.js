(()=>{var e={};e.id=3571,e.ids=[3571],e.modules={13878:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=13878,e.exports=t},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},41808:e=>{"use strict";e.exports=require("net")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},56468:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>b,originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>g});var a={};r.r(a),r.d(a,{GET:()=>c});var s=r(95419),o=r(69108),i=r(99678),n=r(47033),u=r(78070);async function c(){try{let e=(await (0,n.JT)(`
      SELECT 
        b.id, b.userId, b.carId, b.startDate, b.endDate, b.startTime, b.endTime, 
        b.purpose, b.destination, b.status, b.startMileage, b.endMileage, b.mileageDiff,
        b.fuelLevel, b.fuelCost, b.notes, b.createdAt, b.approvedAt, b.approvedBy,
        u.name as userName, u.department as userDepartment, u.email as userEmail, u.phone as userPhone,
        c.name as carName, c.type as carType, c.licensePlate,
        a.name as approverName
      FROM Bookings b
      JOIN Users u ON b.userId = u.id
      JOIN Cars c ON b.carId = c.id
      LEFT JOIN Users a ON b.approvedBy = a.id
      WHERE b.status = 'เสร็จสิ้น'
      ORDER BY b.endDate DESC, b.endTime DESC
      `,[])).recordset.map(e=>({id:e.id,startDate:e.startDate,endDate:e.endDate,startTime:e.startTime,endTime:e.endTime,purpose:e.purpose,destination:e.destination,status:e.status,startMileage:e.startMileage||0,endMileage:e.endMileage||0,mileageDiff:e.mileageDiff||(e.endMileage&&e.startMileage?e.endMileage-e.startMileage:0),fuelLevel:e.fuelLevel||"-",fuelCost:e.fuelCost||0,notes:e.notes||"",createdAt:e.createdAt,approvedAt:e.approvedAt,user:{name:e.userName,department:e.userDepartment,email:e.userEmail,phone:e.userPhone,avatar:"/placeholder.svg?height=40&width=40"},car:{name:e.carName,type:e.carType,licensePlate:e.licensePlate},approver:e.approverName?{name:e.approverName}:null}));return u.Z.json(e)}catch(e){return console.error("Error fetching booking history:",e),u.Z.json({error:"Failed to fetch booking history"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/booking-history/route",pathname:"/api/booking-history",filename:"route",bundlePath:"app/api/booking-history/route"},resolvedPagePath:"C:\\xampp\\htdocs\\car-booking-system-110\\car-booking-system-110\\app\\api\\booking-history\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m,headerHooks:b,staticGenerationBailout:g}=l,h="/api/booking-history/route";function y(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},47033:(e,t,r)=>{"use strict";r.d(t,{Fm:()=>c,JT:()=>n,jB:()=>u});var a=r(63069);let s={host:"43.229.132.209",user:process.env.DB_USER||"rootforbook",password:process.env.DB_PASSWORD||"534jj7?cA",database:process.env.DB_NAME||"carbookingsystem",waitForConnections:!0,connectionLimit:10,queueLimit:0},o=null;async function i(){if(!o)try{console.log("Creating database pool with config:",{host:s.host,user:s.user,database:s.database}),o=a.createPool(s),(await o.getConnection()).release(),console.log("Database pool created and tested successfully")}catch(e){throw console.error("Error creating database pool:",e),Error(`Database connection failed: ${e instanceof Error?e.message:String(e)}`)}return o}async function n(e,t=[]){try{let r=await i();console.log("Executing query:",e,"with params:",t);let[a]=await r.execute(e,t);return{recordset:a}}catch(e){throw console.error("Query execution error:",e),e}}async function u(e,t=[]){try{let{recordset:r}=await n(e,t);return r.length>0?r[0]:null}catch(e){throw console.error("Query execution error:",e),e}}async function c(e,t=[]){try{let r=await i();console.log("Executing insert:",e,"with params:",t);let[a]=await r.execute(e,t);return{insertId:a.insertId}}catch(e){throw console.error("Insert execution error:",e),e}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,3069],()=>r(56468));module.exports=a})();